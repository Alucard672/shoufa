# 版本号配置指南

## 概述

应用版本号现在支持从云端自动读取，无需每次发布时手动修改代码。

## 配置方式

### 1. 创建 `app_config` 集合

在微信开发者工具的云开发控制台中：

1. 进入 **云开发** → **数据库**
2. 点击 **新建集合**
3. 集合名称：`app_config`
4. 权限设置：**所有用户可读，仅创建者可写**（或根据需要调整）

### 2. 添加版本号记录

在 `app_config` 集合中添加一条记录：

```json
{
  "key": "appVersion",
  "value": "1.1.6",
  "description": "应用版本号",
  "updateTime": "2026-01-08T10:00:00.000Z"
}
```

**字段说明：**
- `key`: 固定为 `"appVersion"`
- `value`: 版本号字符串，如 `"1.1.6"`
- `description`: 可选，说明字段
- `updateTime`: 更新时间（可选）

### 3. 更新版本号

当需要更新版本号时：

1. 登录微信开发者工具
2. 进入云开发 → 数据库 → `app_config` 集合
3. 找到 `key` 为 `"appVersion"` 的记录
4. 编辑 `value` 字段，更新为新版本号（如 `"1.1.7"`）
5. 保存

**所有用户下次打开小程序时会自动获取最新版本号！**

## 工作原理

1. **启动时加载**：应用启动时会异步从云端读取版本号
2. **失败回退**：如果云端读取失败（网络问题、集合不存在等），会自动使用本地默认值 `1.1.6`
3. **缓存机制**：版本号存储在 `globalData.version` 中，页面可以直接使用

## 注意事项

- 版本号更新后，用户需要重新打开小程序才能看到新版本号
- 本地代码中仍然保留默认版本号 `VERSION = '1.1.6'` 作为兜底
- 如果云端版本号字段为空或格式错误，会自动使用本地默认值

## 查询版本号

可以通过以下方式获取当前版本号：

```javascript
const app = getApp()
const version = app.globalData.version
console.log('当前版本号:', version)
```

## 故障排查

如果版本号没有更新：

1. 检查 `app_config` 集合是否存在
2. 检查是否有 `key = "appVersion"` 的记录
3. 检查记录的 `value` 字段是否正确
4. 检查网络连接是否正常
5. 查看控制台日志，确认是否有错误信息

