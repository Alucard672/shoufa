# 使用云端安装依赖解决云函数代码包超过 2MB 问题

## 问题

云函数代码包超过 2MB 限制，报错：
```
Error: 系统错误，错误码：80051, source size XXX KB exceed max limit 2MB
```

## ✅ 最佳解决方案：使用云端安装依赖

**不要上传 node_modules**，让云端自动安装依赖。

### 方法一：使用微信开发者工具（推荐）

1. **删除云函数的 node_modules**（可选，但推荐）
   ```bash
   cd cloudfunctions/syncDatabaseSchema
   rm -rf node_modules
   ```

2. **在微信开发者工具中**：
   - 右键点击云函数目录（如 `syncDatabaseSchema`）
   - 选择 **"上传并部署：云端安装依赖"** 或 **"上传并部署：不上传 node_modules"**
   - 这样只会上传代码和 `package.json`，依赖会在云端自动安装

### 方法二：使用命令行（如果支持）

如果 `tcb` 命令行工具支持，可以尝试：
```bash
tcb fn deploy --force syncDatabaseSchema --no-deps
```

但通常微信开发者工具的方式更可靠。

## 前提条件

确保 `package.json` 中有正确的依赖声明：

```json
{
  "dependencies": {
    "wx-server-sdk": "~2.6.3"
  }
}
```

## 为什么这样可以解决问题？

- **不上传 node_modules**：本地 node_modules 可能有 50MB+，但不上传就不会超过 2MB 限制
- **云端自动安装**：腾讯云会在云端根据 `package.json` 自动安装依赖
- **只上传代码**：实际上传的只有代码文件（通常几 KB）和 `package.json`

## 注意事项

1. **确保 package.json 正确**：所有运行时依赖必须在 `package.json` 的 `dependencies` 中声明
2. **不要删除 package.json**：云端需要它来安装依赖
3. **首次部署可能较慢**：云端安装依赖需要一些时间
4. **本地调试**：如果需要本地调试，可以保留 node_modules，但上传时使用"云端安装依赖"

## 如果仍然有问题

1. **检查 package.json**：确保依赖版本正确
2. **检查云函数代码**：确保没有引入不必要的文件
3. **查看部署日志**：检查云端安装依赖是否成功
