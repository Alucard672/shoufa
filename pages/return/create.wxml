<!--pages/return/create.wxml-->
<view class="container">
  <!-- 顶部概览：紧凑展示关联信息 -->
  <view class="header-info card" wx:if="{{issueOrder}}">
    <view class="info-grid">
      <view class="info-cell full-width">
        <text class="info-tag">发料单号</text>
        <text class="info-content">{{issueOrder.issueNo}}</text>
      </view>
      <view class="info-cell">
        <text class="info-tag">加工厂</text>
        <text class="info-content">{{factory.name}}</text>
      </view>
      <view class="info-cell">
        <text class="info-tag">款号</text>
        <text class="info-content">{{style.styleName}}</text>
      </view>
    </view>
  </view>

  <view class="form-section card">
    <view class="form-row">
      <view class="form-item half">
        <text class="form-label">颜色 *</text>
        <search-select 
          placeholder="颜色"
          options="{{colorOptions}}"
          display-key="name"
          value-key="_id"
          selected-values="{{selectedColors}}"
          multiple="{{false}}"
          bindchange="onColorChange"
        />
      </view>
      <view class="form-item half">
        <text class="form-label">尺码</text>
        <search-select 
          placeholder="尺码(可选)"
          options="{{sizeOptions}}"
          display-key="name"
          value-key="_id"
          selected-values="{{selectedSizes}}"
          multiple="{{false}}"
          bindchange="onSizeChange"
        />
      </view>
    </view>

    <view class="form-row">
      <view class="form-item half">
        <text class="form-label">回货打数</text>
        <input 
          class="form-input" 
          type="number" 
          placeholder="0"
          value="{{returnDozens}}"
          bindinput="onDozensInput"
        />
      </view>
      <view class="form-item half">
        <text class="form-label">零散件数</text>
        <input 
          class="form-input" 
          type="number" 
          placeholder="0"
          value="{{returnPieces}}"
          bindinput="onPiecesInput"
        />
      </view>
    </view>

    <view class="form-item">
      <text class="form-label">回货日期</text>
      <picker mode="date" value="{{returnDate}}" bindchange="onDateChange">
        <view class="picker-box">
          {{returnDate || '请选择日期'}}
          <text class="arrow">›</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- 动态计算卡片 -->
  <view class="result-card" wx:if="{{calculatedPieces > 0}}">
    <view class="result-header">回货概览</view>
    <view class="result-main">
      <view class="result-item">
        <view class="val-group">
          <text class="val">{{calculatedQuantityFormatted}}</text>
          <text class="val-total">共{{calculatedPieces}}件</text>
        </view>
        <text class="lab">回货总计</text>
      </view>
      <view class="result-item">
        <text class="val">{{calculatedYarnUsageFormatted}}</text>
        <text class="lab">预计用纱(kg)</text>
      </view>
    </view>
    <view class="result-footer">
      <text class="fee-label">加工费合计</text>
      <text class="fee-value">¥{{calculatedFeeFormatted}}</text>
    </view>
  </view>

  <view class="bottom-actions">
    <button class="btn-submit" bindtap="onSubmit">确认提交回货单</button>
  </view>
</view>

