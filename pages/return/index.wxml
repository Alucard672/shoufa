<!--pages/return/index.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">å›è´§å•</text>
    <text class="page-subtitle">åŠ å·¥å‚å›è´§è®°å½•</text>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-cards">
    <view class="stats-card card-gradient" style="background: linear-gradient(90deg, rgba(0, 201, 80, 1) 0%, rgba(0, 166, 62, 1) 100%);">
      <view class="stats-content">
        <text class="stats-label">ç´¯è®¡å›è´§</text>
        <text class="stats-value">{{totalReturnQuantityDisp}}</text>
        <text class="stats-unit"></text>
      </view>
    </view>

    <view class="stats-card card-gradient" style="background: linear-gradient(90deg, rgba(173, 70, 255, 1) 0%, rgba(152, 16, 250, 1) 100%);">
      <view class="stats-content">
        <text class="stats-label">åŠ å·¥è´¹æ€»é¢</text>
        <text class="stats-value">Â¥{{totalProcessingFeeFormatted}}</text>
        <text class="stats-unit">å…ƒ</text>
      </view>
    </view>
  </view>

  <!-- æ—¶é—´ç­›é€‰ -->
  <filter-tabs 
    options="{{['å…¨éƒ¨æ—¶é—´', 'ä»Šå¤©', 'æœ¬å‘¨', 'æœ¬æœˆ']}}"
    current="{{timeFilterIndex}}"
    bindchange="onTimeFilterChange"
  />

  <!-- çŠ¶æ€ç­›é€‰ -->
  <filter-tabs 
    options="{{['å…¨éƒ¨', 'è¿›è¡Œä¸­', 'å·²å®Œæˆ']}}"
    current="{{statusFilterIndex}}"
    bindchange="onStatusFilterChange"
  />

  <!-- æœç´¢æ¡† -->
  <view class="search-container">
    <search-box 
      placeholder="æœç´¢å›è´§å•å·"
      bindsearch="onSearch"
    />
  </view>

  <!-- å›è´§å•åˆ—è¡¨ -->
  <view class="order-list">
    <view class="order-card card" wx:for="{{filteredOrders}}" wx:key="_id">
      <view class="order-header">
        <view class="order-title">
          <text class="factory-name">{{item.factoryName}}</text>
          <badge type="{{item.settlementStatus === 'æœªç»“ç®—' ? 'warning' : item.settlementStatus === 'éƒ¨åˆ†ç»“ç®—' ? 'info' : 'success'}}" text="{{item.settlementStatus}}" />
        </view>
        <view class="order-header-right">
          <text class="order-no">{{item.returnNo}}</text>
          <view class="share-btn" bindtap="onShareReturnOrder" data-id="{{item._id}}" catchtap="stopPropagation">
            <text>åˆ†äº«</text>
          </view>
        </view>
      </view>
      
      <view class="order-info">
        <text class="info-text">å‘æ–™å•: {{item.issueNo}}</text>
        <view class="style-info-row" wx:if="{{item.styleDisplay || item.styleName}}">
          <view class="style-image-container">
            <image class="style-image" src="{{item.styleImageUrl}}" mode="aspectFill" wx:if="{{item.styleImageUrl}}"></image>
            <view class="style-image-placeholder" wx:else>
              <image class="placeholder-icon" src="/images/icons/camera.svg" mode="aspectFit"></image>
            </view>
          </view>
          <text class="info-text info-text-right">æ¬¾å·: <text style="font-weight: 700; color: #1E293B;">{{item.styleCode ? '[' + item.styleCode + '] ' : ''}}{{item.styleName}}</text></text>
        </view>
      </view>
      
      <view class="order-details">
        <view class="detail-item">
          <text class="detail-label">å›è´§æ•°é‡</text>
          <text class="detail-value">{{item.quantityFormatted}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å•ä»·</text>
          <text class="detail-value fee-value">Â¥{{item.pricePerPieceFormatted}}/ä»¶</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ€»é‡‘é¢</text>
          <text class="detail-value fee-value">{{item.processingFeeFormatted}}</text>
        </view>
      </view>
      
      <view class="order-meta">
        <view class="meta-row">
          <text class="meta-text" wx:if="{{item.color}}">{{item.color}}</text>
          <text class="meta-separator" wx:if="{{item.color && item.size}}">Â·</text>
          <text class="meta-text" wx:if="{{item.size}}">{{item.size}}</text>
        </view>
        <view class="meta-row">
          <text class="meta-text">ç”¨çº±: {{item.actualYarnUsageFormatted}}kg</text>
          <text class="meta-separator">Â·</text>
          <text class="meta-text">{{item.returnDateFormatted}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- éšè—çš„ç”»å¸ƒç”¨äºç”Ÿæˆåˆ†äº«å›¾ç‰‡ -->
  <canvas 
    canvas-id="shareCanvas" 
    style="position: fixed; top: -9999px; left: -9999px; width: 750px; height: 1200px;"
    disable-scroll="true"
  ></canvas>

  <!-- åˆ†äº«é€‰é¡¹å¼¹çª— -->
  <view class="share-modal" wx:if="{{showShareModal}}" catchtouchmove="true">
    <view class="share-modal-content">
      <view class="share-options">
        <view class="share-option" bindtap="saveImageToAlbum">
          <text class="share-option-icon">ğŸ“·</text>
          <text class="share-option-text">ä¿å­˜åˆ°ç›¸å†Œ</text>
        </view>
        <view class="share-option" bindtap="previewImage">
          <text class="share-option-icon">ğŸ‘ï¸</text>
          <text class="share-option-text">é¢„è§ˆå›¾ç‰‡</text>
        </view>
      </view>
      <view class="share-modal-close" bindtap="closeShareModal">
        <text>å–æ¶ˆ</text>
      </view>
    </view>
  </view>
</view>

