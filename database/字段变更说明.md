# 数据库字段变更说明

## styles 表新增字段

### imageUrl（图片URL）

- **字段类型**：String
- **是否必填**：否
- **说明**：存储款式图片的云存储文件ID
- **格式**：`cloud://env-id.xxx/cloudbase-xxx/styles/xxx.jpg`
- **用途**：在款号列表和详情中显示款式图片

### category（类别）

- **字段类型**：String
- **是否必填**：否
- **说明**：款号类别，如"针织类"、"卫衣类"、"运动类"等
- **用途**：用于分类展示和筛选

### lossRate（损耗率）

- **字段类型**：Number
- **是否必填**：否
- **说明**：损耗率百分比，如 3 表示 3%
- **用途**：计算实际用量（含损耗）

### actualUsage（实际用量）

- **字段类型**：Number
- **是否必填**：否
- **说明**：实际用量（含损耗），单位：kg
- **计算公式**：`actualUsage = yarnUsagePerPiece / 1000 * (1 + lossRate / 100)`
- **用途**：显示实际用纱量

### yarnIds（关联纱线）

- **字段类型**：Array<String>
- **是否必填**：否
- **说明**：关联的纱线库存ID列表
- **用途**：发料时自动扣减关联纱线的库存

## 数据迁移

### 现有数据

对于已存在的款号数据：
- `imageUrl`：默认为空字符串 `''`
- `category`：如果已有数据，保持不变；新数据可为空
- `lossRate`：如果已有数据，保持不变；新数据默认为 0
- `actualUsage`：如果已有数据，保持不变；新数据根据 `yarnUsagePerPiece` 和 `lossRate` 自动计算
- `yarnIds`：如果已有数据，保持不变；新数据默认为空数组 `[]`

### 兼容性

所有新增字段都是**可选字段**，不会影响现有功能。如果字段不存在，系统会使用默认值。

## 索引建议

无需为新增字段创建索引，因为：
- `imageUrl`：不用于查询
- `category`：如果后续需要按类别筛选，可以添加索引
- `lossRate`、`actualUsage`：不用于查询
- `yarnIds`：不用于查询


