# 租户创建指南

## 方式一：通过小程序界面创建（推荐）

### 前提条件
- 已经部署了 `auth` 云函数
- 数据库中至少有一个租户（可以先通过方式二创建）

### 操作步骤

1. **登录小程序**
   - 打开小程序，点击"开发环境直接登录"
   - 如果提示没有租户，先通过方式二创建一个

2. **进入租户管理页面**
   - 登录后，点击底部导航栏的"我的"
   - 点击"基础信息设置"
   - 找到"租户管理"选项，点击进入

3. **创建新租户**
   - 点击右上角的"+ 新增租户"按钮
   - 填写租户信息：
     - **租户名称**（必填）：例如"XX公司"
     - **联系人**（可选）：联系人姓名
     - **联系电话**（可选）：联系电话
     - **地址**（可选）：公司地址
   - 点击"保存"按钮

4. **完成**
   - 创建成功后，租户会出现在租户列表中
   - 可以继续创建更多租户，或编辑/删除已有租户

---

## 方式二：直接在MySQL数据库中创建

### 适用场景
- 首次使用，数据库中还没有租户
- 需要通过SQL批量创建租户
- 小程序界面无法访问时

### 操作步骤

#### 方法A：使用腾讯云开发控制台

1. **登录腾讯云开发控制台**
   - 访问：https://console.cloud.tencent.com/tcb
   - 选择对应的环境（cloud1-3g9cra4h71f647dd）

2. **进入数据库管理**
   - 点击左侧菜单"数据库"
   - 选择"MySQL"数据库
   - 选择对应的数据库实例

3. **执行SQL语句**
   - 点击"SQL查询"或"数据管理"
   - 复制以下SQL语句并执行：

```sql
-- 创建测试租户
INSERT INTO `tenants` (`name`, `contact`, `phone`, `address`, `create_time`, `update_time`, `deleted`) 
VALUES 
('测试租户', '管理员', '13800138000', '测试地址', NOW(), NOW(), 0);
```

4. **验证创建**
   - 执行查询语句验证：

```sql
SELECT * FROM `tenants` WHERE `deleted` = 0;
```

#### 方法B：使用MySQL客户端工具

1. **连接MySQL数据库**
   - 使用MySQL Workbench、Navicat等工具
   - 或使用命令行mysql客户端

2. **连接信息**
   - 主机：从腾讯云控制台获取MySQL实例地址
   - 端口：3306（默认）
   - 数据库：cloud1-3g9cra4h71f647dd
   - 用户名/密码：从腾讯云控制台获取

3. **执行SQL**
   - 执行 `database/create_tenant.sql` 文件中的SQL语句
   - 或直接执行上面的INSERT语句

---

## 快速创建测试租户的SQL

```sql
-- 快速创建测试租户
INSERT INTO `tenants` (`name`, `contact`, `phone`, `address`) 
VALUES 
('测试租户', '管理员', '13800138000', '测试地址');

-- 创建多个测试租户
INSERT INTO `tenants` (`name`, `contact`, `phone`, `address`) 
VALUES 
('租户A', '联系人A', '13800000001', '地址A'),
('租户B', '联系人B', '13800000002', '地址B'),
('租户C', '联系人C', '13800000003', '地址C');
```

---

## 注意事项

1. **租户ID自动生成**
   - `id` 字段是自增主键，会自动生成
   - `create_time` 和 `update_time` 会自动设置为当前时间

2. **软删除**
   - `deleted` 字段默认为 0（未删除）
   - 删除租户时，建议设置为 1（软删除），而不是物理删除

3. **多租户隔离**
   - 创建租户后，该租户下的所有数据都会自动关联 `tenant_id`
   - 确保数据隔离和安全性

4. **首次使用建议**
   - 建议先通过方式二创建一个测试租户
   - 然后登录小程序，使用方式一创建正式租户

---

## 常见问题

**Q: 创建租户后还是无法登录？**
A: 检查以下几点：
- 确认 `auth` 云函数已部署并更新
- 确认数据库中 `tenants` 表已创建
- 确认租户记录的 `deleted` 字段为 0
- 查看云函数日志，检查是否有错误

**Q: 如何查看所有租户？**
A: 执行SQL查询：
```sql
SELECT * FROM `tenants` WHERE `deleted` = 0 ORDER BY `create_time` DESC;
```

**Q: 如何删除租户？**
A: 建议使用软删除：
```sql
UPDATE `tenants` SET `deleted` = 1 WHERE `id` = 租户ID;
```

